// media.js v0.8.3 Copyright (C) 2013 Visman (visman@inbox.ru)
if("undefined"===typeof FluxBB||!FluxBB)var FluxBB={};FluxBB.media=function(l,u,p){function v(e,c,b){var a,k="",h=q(e);if(h.canPlayType){for(a=0;a<c.length;a++)""!==h.canPlayType(e+"/"+b[a])&&(r[c[a]]=e+"/"+b[a],k+=(k?"|":"")+c[a]);return k?RegExp("^([^\\\\\\?\\s<>\"'&]+\\.)("+k+")$","i"):!1}return!1}function q(e){return l.createElementNS?l.createElementNS("http://www.w3.org/1999/xhtml",e):l.createElement(e)}function s(e,c,b,a,k){if("string"!==typeof c)return e.appendChild(c);var h,f="video"==c||"audio"==c;b=b||{};a=a||{};c=q(c);for(var d in b)b.hasOwnProperty(d)&&("style"==d?c.style.cssText=b[d]:c.setAttribute(d,b[d]));f&&(h=q("source"));for(d in a)a.hasOwnProperty(d)&&(f?h.setAttribute(d,a[d]):(h=q("param"),h.setAttribute("name",d),h.setAttribute("value",a[d]),c.appendChild(h)));f&&c.appendChild(h);if(!k)return e.appendChild(c);b=e.parentNode;return(e=e.nextSibling)?b.insertBefore(c,e):b.appendChild(c)}function g(e,c,b,a){var k,h;a=a||{};if(a[n]&&(a=a[n].split(":"),a[0]>=w))if(c[a[1]])k=a[1];else return!0;!k&&c.i&&(k="i");!k&&c.v&&(k="v");!k&&c.a&&(k="a");if(!k){if(!A)return!1;k="o"}b=b||{};b.wt=b.wt||640;b.ht=b.ht||360;var f=c[k][0],d=c[k][1]?c[k][1]:{};"i"==k?(h="iframe",f.frameborder="0"):"v"==k?h="video":"a"==k?h="audio":(h="object",f.type=t,d.wmode="transparent");f.id="mediajs"+B++;2==b.tp?(a=e.parentNode.clientWidth||e.parentNode.offsetWidth,a<b.wt&&(b.ht=parseInt(b.ht*a/b.wt),b.wt=a),f.width=b.wt,f.height=b.ht,c={style:"padding-top:5px;"},b={}):1==b.tp?(f.width="100%",f.height=b.ht,c={style:"padding-top:5px;overflow:hidden;position:relative;"+("string"==typeof b.wt?"width:"+b.wt+";":"max-width:"+b.wt+"px;")},b={style:"height:"+b.ht+";overflow:hidden;position:relative;"}):(f.style="position:absolute;left:0;top:0;width:100%;height:100%;",c={style:"padding-top:5px;overflow:hidden;position:relative;max-width:"+b.wt+"px;"},b={style:"overflow:hidden;position:relative;height:0;padding-bottom:"+100*b.ht/b.wt+"%;"});if("ie"==n&&"o"==k){h=k="";for(var g in f)f.hasOwnProperty(g)&&("data"==g?d.movie=f[g]:"type"!=g&&(k+=" "+g+'="'+f[g]+'"'));for(g in d)d.hasOwnProperty(g)&&(h+='<param name="'+g+'" value="'+d[g]+'" />');a=q("div");a.innerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+k+">"+h+"</object>";h=a.firstChild;a.removeChild(h)}s(s(s(e,"div",c,{},!0),"div",b),h,f,d);e.className+=(e.className?" ":"")+"mediajslink";return!0}var B=0,r={},t="application/x-shockwave-flash",n=u.ActiveXObject?"ie":"0",w="ie"!=n?0:l.addEventListener?9:l.querySelector?8:u.XMLHttpRequest?7:l.compatMode?6:0,x="ie"==n&&9>w,A=function(){if(p.plugins&&p.plugins.length&&p.mimeTypes&&p.mimeTypes[t]&&p.mimeTypes[t].enabledPlugin)return!0;if("ie"==n)try{if(new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))return!0}catch(e){}return!1}(),y=v("audio","mp3 m4a ogg oga webma wav".split(" "),"mpeg mp4 ogg ogg webm wav".split(" ")),z=v("video",["mp4","m4v","ogv","webm","webmv"],["mp4","mp4","ogg","webm","webm"]);return{run:function(){var e;e=(e=l.getElementById("brdmain"))||l;if(e.querySelectorAll)e=e.querySelectorAll(".postmsg");else if(e.getElementsByClassName)e=e.getElementsByClassName("postmsg");else{e=e.all||e.getElementsByTagName("*");for(var c=[],b=0,a;a=e[b++];)a.className&&-1<(" "+a.className+" ").indexOf(" postmsg ")&&(c[c.length]=a);e=c}for(var k in e)if(e[k].className&&!(-1<(" "+e[k].className+" ").indexOf(" postsignature "))){var c=e[k].getElementsByTagName("a"),h;for(h in c)if(c[h].href&&(!c[h].nextSibling||c[h].nextSibling.tagName&&"BR"==c[h].nextSibling.tagName.toUpperCase())&&(!c[h].previousSibling||c[h].previousSibling.tagName&&"BR"==c[h].previousSibling.tagName.toUpperCase())&&"P"==c[h].parentNode.tagName.toUpperCase()&&!/<(p|a|img|ul|ol)/i.test(c[h].innerHTML)){var b=c[h],f=a=void 0,d=void 0,m=b.href;(a=m.split("re.php?u="))&&a[1]&&(m=decodeURIComponent(a[1]).replace(/(https?|ftp)___/g,"$1://"));m=m.replace(/&amp;/g,"&");if(f=m.match(/^(https?:\/\/)(www\.)?(.+)$/))d=f[3],f[4]="https:"==l.location.protocol?"https://":f[1],(a=d.match(/^(youtube\.com\/.*v=|youtu\.be\/)([-\w]+)/))?g(b,{i:[{src:f[4]+"www.youtube.com/embed/"+a[2]+"?wmode=transparent",allowfullscreen:"true"}]}):(a=d.match(/^(player\.)?vimeo\.com\/(\d+)/))?g(b,{i:[{src:f[4]+"player.vimeo.com/video/"+a[2],allowfullscreen:"true"}]}):(a=d.match(/^dailymotion\.com\/video\/([a-zA-Z\d]+)_/))?g(b,{i:[{src:f[4]+"www.dailymotion.com/embed/video/"+a[1]+'?theme=none"',allowfullscreen:"true"}]}):(a=d.match(/^rutube\.ru\/tracks\/(\d+)\.html\?v=([a-zA-Z\d]+)/))?g(b,{o:[{data:f[4]+"video.rutube.ru/"+a[2]},{allowFullScreen:"true",allowScriptAccess:"always"}]}):(a=d.match(/^(rutube\.ru\/video\/embed|video\.rutube\.ru)\/(\d+)/))?g(b,{i:[{src:f[4]+"rutube.ru/video/embed/"+a[2],allowfullscreen:"true"}],o:[{data:f[4]+"video.rutube.ru/"+a[2]},{allowFullScreen:"true",allowScriptAccess:"always"}]},{},{ie:"7:o"}):(a=d.match(/^rutube\.ru\/video\/([a-zA-Z\d]+)/))?g(b,{i:[{src:f[4]+"rutube.ru/video/embed/"+a[1],allowfullscreen:"true"}],o:[{data:f[4]+"video.rutube.ru/"+a[1]},{allowFullScreen:"true",allowScriptAccess:"always"}]},{},{ie:"7:o"}):(a=d.match(/^(static\.)?video\.yandex\.ru\/(iframe|lite)\/([-\w\.\/]+)\//))?g(b,{i:[{src:f[4]+ "video.yandex.ru/iframe/"+a[3],allowfullscreen:"true"}]}):(a=d.match(/^video\.mail\.ru\/([-\w]+)\/([-\w]+)\/([-\w]+)\/([-\w]+)\.html/))?g(b,{o:[{data:"http://img.mail.ru/r/video2/uvpv3.swf?2"},{allowFullScreen:"true",allowScriptAccess:"always",flashvars:"movieSrc="+a[1]+"/"+a[2]+"/"+a[3]+"/"+a[4]+"&autoplay=0"}]}):(a=d.match(/^smotri\.com\/video\/view\/\?id=([a-zA-Z\d]+)/))?g(b,{o:[{data:"http://pics.smotri.com/player.swf?file="+a[1]+"&bufferTime=3&autoStart=false&str_lang=rus"},{allowFullScreen:"true",allowScriptAccess:"always"}]}):(a=d.match(/^(soundcloud\.com\/[-\w]+\/(sets\/)?[-\w]+|api\.soundcloud\.com\/(tracks|playlists)\/\d+)/))?g(b,{i:[{src:"https://w.soundcloud.com/player/?sharing=false&liking=false&show_playcount=false&show_comments=false&url="+m,scrolling:"no"}]},{wt:"100%",ht:a[2]||"playlists"==a[3]?x?225:450:x?81:166,tp:1}):(a=d.match(/^maps\.google\.([a-z]+)\/([a-z\d\?\.,\&\=]+)$/))?g(b,{i:[{src:"https://maps.google."+a[1]+"/"+a[2]+"&ie=UTF8&output=embed",scrolling:"no",marginheight:"0",marginwidth:"0"}]},{wt:410,ht:350,tp:2}):(a=d.match(/^www(\d+)\.zippyshare\.com\/v(\/|.*key=)(\d+)/))?g(b,{o:[{data:"http://www"+a[1]+".zippyshare.com/swf/player_local.swf?file="+a[3]+"&server="+a[1]+"&baseurl=http://www.zippyshare.com/api/&flashid=null&autostart=false&availablequality=both"},{allowScriptAccess:"always",allowFullScreen:"false"}]},{wt:"100%",ht:80,tp:1}):(a=d.match(/^metacafe\.com\/watch\/([-\w]+)/))?g(b,{i:[{src:"http://www.metacafe.com/embed/"+a[1]+"/",allowfullscreen:"true"}]}):(a=d.match(/^video\.sibnet\.ru\/video(\d+)/))?g(b,{i:[{src:f[4]+"video.sibnet.ru/shell.php?videoid="+a[1]+"/",allowfullscreen:"true",scrolling:"no"}]}):(a=d.match(/^promodj\.com\/([^\/]+\/[^\/]+|download|embed)\/(\d+)/))?g(b,{i:[{src:f[4]+"promodj.com/embed/"+a[2]+"/big",allowfullscreen:"true"}]},{wt:"100%",ht:70,tp:1}):(a=d.match(/^(embed\.)?pleer\.com\/track(s\/|\?id=)(\w+)/))?g(b,{o:[{data:"http://embed.pleer.com/track?id="+a[3]}]},{wt:"100%",ht:42,tp:1}):(a=d.match(/^(embed\.)?pleer\.com\/list(\?id=)?(\w+)/))?g(b,{o:[{data:"http://embed.pleer.com/list?id="+a[3]}]},{wt:"100%",ht:300,tp:1}):(a=d.match(/^([a-z]{1,3}\.)?(ign\.com\/videos\/\d{4}\/\d{2}\/\d{2}\/[\w-]+)/))?g(b,{i:[{src:"http://widgets.ign.com/video/embed/content.html?url=http://www."+a[2],allowfullscreen:"true",scrolling:"no"}]}):(a=d.match(/^([a-z]{1,3}\.)?twitch\.tv\/(\w+)\/([bc])\/(\d+)/))?g(b,{o:[{data:"http://www.twitch.tv/widgets/archive_embed_player.swf"},{allowFullScreen:"true",allowScriptAccess:"always",flashvars:"auto_play=false&channel="+a[2]+"&"+("b"==a[3]?"archive_id=":"chapter_id=")+a[4]}]}):(a=d.match(/^([a-z]{1,3}\.)?twitch\.tv\/(\w+)$/))?g(b,{o:[{data:"http://www.twitch.tv/widgets/live_embed_player.swf?channel="+a[2]},{allowFullScreen:"true",allowScriptAccess:"always",flashvars:"auto_play=false&hostname=www.twitch.tv&channel="+a[2]}]}):(a=d.match(/^g4tv\.com\/(videos|lv3)\/(\d+)/))?g(b,{o:[{data:"http://www.g4tv.com/lv3/"+a[2]},{allowFullScreen:"true",allowScriptAccess:"always"}]}):(a=d.match(/^([a-z]{1,3}\.)?gamespot\.com\/(videoembed\/|video\/\d+\/|[\w\/-]+\/video\/|[\w-]+\/videos\/[\w-]+-)(\d+)/))?g(b,{i:[{src:"http://"+(a[1]?a[1]:"www.")+"gamespot.com/videoembed/"+a[3]+"&mapp=false&ads=0&onsite=0",allowfullscreen:"true"}]}):(a=d.match(/^([^\\\?\s<>"'&]+\.mp3)$/)&&g(b,{o:[{data:"swf/mp3player.swf"},{FlashVars:"soundFile="+m,quality:"high",menu:"false"}]},{wt:"100%",ht:24,tp:1}))||(y&&(a=d.match(y))?g(b,{a:[{controls:!0,preload:"metadata"},{src:f[1]+(f[2]?f[2]:"")+a[1]+a[2],type:r[a[2]]}]},{wt:300,ht:32,tp:2}):z&&(a=d.match(z))&&g(b,{v:[{controls:!0,preload:"metadata"},{src:f[1]+(f[2]?f[2]:"")+a[1]+a[2],type:r[a[2]]}]}))}}},init:function(){l.addEventListener?l.addEventListener("DOMContentLoaded",FluxBB.media.run(),!1):/in/.test(l.readyState)?setTimeout(FluxBB.media.init,100):FluxBB.media.run()}}}(document,window,navigator);FluxBB.media.init();