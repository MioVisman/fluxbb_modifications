// media.js v1.0.0 Copyright (C) 2013-2015 Visman (mio.visman@yandex.ru)
if("undefined"===typeof FluxBB||!FluxBB)var FluxBB={};FluxBB.media=function(l,u,p){function v(k,h,d){var e,b="",a=q(k);if(a.canPlayType){for(e=0;e<h.length;e++)""!==a.canPlayType(k+"/"+d[e])&&(r[h[e]]=k+"/"+d[e],b+=(b?"|":"")+h[e]);return b?new RegExp("^([^\\\\\\?\\s<>\"'&]+\\.)("+b+")$","i"):!1}return!1}function w(k,h){h=h||l;if(h.querySelectorAll)return h.querySelectorAll("."+k);if(h.getElementsByClassName)return h.getElementsByClassName(k);for(var d=h.all||h.getElementsByTagName("*"),e=[],b=0,a;a=d[b++];)a.className&&-1<(" "+a.className+" ").indexOf(" "+k+" ")&&(e[e.length]=a);return e}function q(k){return l.createElementNS?l.createElementNS("http://www.w3.org/1999/xhtml",k):l.createElement(k)}function t(k,h,d,e,b){if("string"!==typeof h)return k.appendChild(h);var a,f="video"==h||"audio"==h;d=d||{};e=e||{};h=q(h);for(var c in d)d.hasOwnProperty(c)&&("style"==c?h.style.cssText=d[c]:h.setAttribute(c,d[c]));f&&(a=q("source"));for(c in e)e.hasOwnProperty(c)&&(f?a.setAttribute(c,e[c]):(a=q("param"),a.setAttribute("name",c),a.setAttribute("value",e[c]),h.appendChild(a)));f&&h.appendChild(a);if(!b)return k.appendChild(h);d=k.parentNode;return(k=k.nextSibling)?d.insertBefore(h,k):d.appendChild(h)}function g(k,h,d,e){var b,a;e=e||{};if(e[n]&&(e=e[n].split(":"),e[0]>=x))if(h[e[1]])b=e[1];else return!0;!b&&h.i&&(b="i");!b&&h.v&&(b="v");!b&&h.a&&(b="a");if(!b){if(!C)return!1;b="o"}d=d||{};d.wt=d.wt||640;d.ht=d.ht||360;var f=h[b][0],c=h[b][1]?h[b][1]:{};"i"==b?(a="iframe",f.frameborder="0",f.scrolling="no"):"v"==b?a="video":"a"==b?a="audio":(a="object",f.type="application/x-shockwave-flash",c.wmode="transparent");f.id="mediajs"+D++;2==d.tp?(e=k.parentNode.clientWidth||k.parentNode.offsetWidth,e<d.wt&&(d.ht=parseInt(d.ht*e/d.wt),d.wt=e),f.width=d.wt,f.height=d.ht,h={style:"padding-top:5px;"},d={}):1==d.tp?(f.width="100%",f.height=d.ht,h={style:"padding-top:5px;overflow:hidden;position:relative;"+("string"==typeof d.wt?"width:"+d.wt+";":"max-width:"+d.wt+"px;")},d={style:"height:"+d.ht+";overflow:hidden;position:relative;"}):(f.style="position:absolute;left:0;top:0;width:100%;height:100%;",h={style:"padding-top:5px;overflow:hidden;position:relative;max-width:"+d.wt+"px;"},d={style:"overflow:hidden;position:relative;height:0;padding-bottom:"+100*d.ht/d.wt+"%;"});if("ie"==n&&"o"==b){a=b="";for(var g in f)f.hasOwnProperty(g)&&("data"==g?c.movie=f[g]:"type"!=g&&(b+=" "+g+'="'+f[g]+'"'));for(g in c)c.hasOwnProperty(g)&&(a+='<param name="'+g+'" value="'+c[g]+'" />');e=q("div");e.innerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+b+">"+a+"</object>";a=e.firstChild;e.removeChild(a)}t(t(t(k, "div",h,{},!0),"div",d),a,f,c);k.className+=(k.className?" ":"")+"mediajslink";return!0}var D=0,y="",r={},n=u.ActiveXObject?"ie":"0",x="ie"!=n?0:l.addEventListener?9:l.querySelector?8:u.XMLHttpRequest?7:l.compatMode?6:0,z="ie"==n&&9>x,C=function(){if(p.plugins&&p.plugins.length&&p.mimeTypes&&p.mimeTypes["application/x-shockwave-flash"]&&p.mimeTypes["application/x-shockwave-flash"].enabledPlugin)return!0;if("ie"==n)try{if(new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))return!0}catch(g){}return!1}(),A=v("audio","mp3 m4a ogg oga webma wav".split(" "),"mpeg mp4 ogg ogg webm wav".split(" ")),B=v("video",["mp4","m4v","ogv","webm","webmv"],["mp4","mp4","ogg","webm","webm"]);return{run:function(){var k;if(k=l.getElementById("brd-main"))k=w("entry-content",k),y=PUNBB.env.sva_mediajs.url_swf+"/";else if(!(k=w("postmsg")))return;for(var h in k)if(k[h].className&&!(-1<(" "+k[h].className+" ").indexOf(" postsignature "))){var d=k[h].getElementsByTagName("a"),e;for(e in d)if(d[e].href&&(!d[e].nextSibling|| d[e].nextSibling.tagName&&"BR"==d[e].nextSibling.tagName.toUpperCase())&&(!d[e].previousSibling||d[e].previousSibling.tagName&&"BR"==d[e].previousSibling.tagName.toUpperCase())&&"P"==d[e].parentNode.tagName.toUpperCase()&&!/<(p|a|img|ul|ol)/i.test(d[e].innerHTML)){var b=d[e],a=void 0,f=void 0,c=void 0,m=b.href;(a=m.split("re.php?u="))&&a[1]&&(m=decodeURIComponent(a[1]).replace(/(https?|ftp)___/g,"$1://"));m=m.replace(/&amp;/g,"&");if(f=m.match(/^(https?:\/\/)(www\.)?(.+)$/))c=f[3],f[4]="https:"==l.location.protocol?"https://":f[1],(a=c.match(/^youtu(be\.com\/.*v=|\.be\/)([-\w]+)(.*[\?&#](star)?t=([\dhms]+))?/))?(f=f[4]+"www.youtube.com/embed/"+a[2]+"?wmode=transparent",a[5]?(c=a[5],a="&start="+(/^\d+$/.test(c)?c:(c=c.match(/^((\d{1,2})h)?((\d{1,2})m)?((\d{1,2})s)?$/))?3600*(c[2]||0)+60*(c[4]||0)+1*(c[6]||0):0)):a="",g(b,{i:[{src:f+a,allowfullscreen:"true"}]})):(a=c.match(/^(player\.)?vimeo\.com\/(video\/)?(\d+)/))?g(b,{i:[{src:f[4]+"player.vimeo.com/video/"+a[3],allowfullscreen:"true"}]}):(a=c.match(/^dai(lymotion\.com\/video|\.ly)\/([a-zA-Z\d]+)/))?g(b,{i:[{src:f[4]+"www.dailymotion.com/embed/video/"+a[2]+'?theme=none"',allowfullscreen:"true"}]}):(a=c.match(/^rutube\.ru\/tracks\/(\d+)\.html\?v=([a-zA-Z\d]+)/))?g(b,{o:[{data:f[4]+"video.rutube.ru/"+a[2]},{allowFullScreen:"true",allowScriptAccess:"always"}]}):(a=c.match(/^(rutube\.ru\/video\/embed|video\.rutube\.ru)\/(\d+)/))?g(b,{i:[{src:f[4]+"rutube.ru/video/embed/"+a[2],allowfullscreen:"true"}],o:[{data:f[4]+"video.rutube.ru/"+a[2]},{allowFullScreen:"true",allowScriptAccess:"always"}]},{},{ie:"7:o"}):(a=c.match(/^rutube\.ru\/video\/([a-zA-Z\d]+)/))?g(b,{i:[{src:f[4]+"rutube.ru/video/embed/"+a[1],allowfullscreen:"true"}],o:[{data:f[4]+"video.rutube.ru/"+a[1]},{allowFullScreen:"true",allowScriptAccess:"always"}]},{},{ie:"7:o"}):(a=c.match(/^(static\.)?video\.yandex\.ru\/(iframe|lite)\/([-\w\.\/]+)\//))?g(b,{i:[{src:f[4]+"video.yandex.ru/iframe/"+a[3],allowfullscreen:"true"}]}):(a=c.match(/^(video\.mail\.ru|my\.mail\.ru\/video\/.+\#video\=|my\.mail\.ru\/video)\/([-\w]+\/[-\w\.]+\/[-\w\.]+\/[-\w]+)(\.html)?/))?g(b,{i:[{src:"http://api.video.mail.ru/videos/embed/"+a[2]+".html",allowfullscreen:"true"}]}):(a=c.match(/^smotri\.com\/video\/view\/\?id=([a-zA-Z\d]+)/))?g(b,{o:[{data:"http://pics.smotri.com/player.swf?file="+a[1]+"&bufferTime=3&autoStart=false&str_lang=rus"},{allowFullScreen:"true",allowScriptAccess:"always"}]}):(a=c.match(/^(soundcloud\.com\/[-\w]+\/(sets\/)?[-\w]+|api\.soundcloud\.com\/(tracks|playlists)\/\d+)/))?g(b,{i:[{src:"https://w.soundcloud.com/player/?sharing=false&liking=false&show_playcount=false&show_comments=false&url="+m}]},{wt:"100%",ht:a[2]||"playlists"==a[3]?z?225:450:z?81:166,tp:1}):(a=c.match(/^maps\.google\.([a-z]+)\/([a-z\d\?\.,\&\=]+)$/))?g(b,{i:[{src:"https://maps.google."+a[1]+"/"+a[2]+"&ie=UTF8&output=embed",marginheight:"0",marginwidth:"0"}]},{wt:410,ht:350,tp:2}):(a=c.match(/^www(\d+)\.zippyshare\.com\/v(\/|.*key=)(\d+)/))?g(b,{o:[{data:"http://www"+a[1]+".zippyshare.com/swf/player_local.swf?file="+a[3]+"&server="+a[1]+"&baseurl=http://www.zippyshare.com/api/&flashid=null&autostart=false&availablequality=both"},{allowScriptAccess:"always",allowFullScreen:"false"}]},{wt:"100%",ht:80,tp:1}):(a=c.match(/^metacafe\.com\/watch\/([-\w]+)/))?g(b,{i:[{src:"http://www.metacafe.com/embed/"+a[1]+"/",allowfullscreen:"true"}]}):(a=c.match(/^video\.sibnet\.ru\/video(\d+)/))?g(b,{i:[{src:f[4]+"video.sibnet.ru/shell.php?videoid="+a[1]+"/",allowfullscreen:"true"}]}):(a=c.match(/^promodj\.com\/([^\/]+\/[^\/]+|download|embed)\/(\d+)/))?g(b,{i:[{src:f[4]+"promodj.com/embed/"+a[2]+"/big",allowfullscreen:"true"}]},{wt:"100%",ht:70,tp:1}):(a=c.match(/^(embed\.)?pleer\.com\/track(s\/|\?id=)(\w+)/))?g(b,{o:[{data:"http://embed.pleer.com/track?id="+a[3]}]},{wt:"100%",ht:42,tp:1}):(a=c.match(/^(embed\.)?pleer\.com\/list(\?id=)?(\w+)/))?g(b,{o:[{data:"http://embed.pleer.com/list?id="+a[3]}]},{wt:"100%",ht:300,tp:1}):(a=c.match(/^([a-z]{1,3}\.)?(ign\.com\/videos\/\d{4}\/\d{2}\/\d{2}\/[\w-]+)/))?g(b,{i:[{src:"http://widgets.ign.com/video/embed/content.html?url=http://www."+a[2],allowfullscreen:"true"}]}):(a=c.match(/^([a-z]{1,3}\.)?twitch\.tv\/(\w+)\/([bc])\/(\d+)/))?g(b,{o:[{data:"http://www.twitch.tv/widgets/archive_embed_player.swf"},{allowFullScreen:"true",allowScriptAccess:"always",flashvars:"auto_play=false&channel="+a[2]+"&"+("b"==a[3]?"archive_id=":"chapter_id=")+a[4]}]}):(a=c.match(/^([a-z]{1,3}\.)?twitch\.tv\/(\w+)$/))?g(b,{o:[{data:"http://www.twitch.tv/widgets/live_embed_player.swf?channel="+a[2]},{allowFullScreen:"true",allowScriptAccess:"always",flashvars:"auto_play=false&hostname=www.twitch.tv&channel="+a[2]}]}):(a=c.match(/^g4tv\.com\/(videos|lv3)\/(\d+)/))?g(b,{o:[{data:"http://www.g4tv.com/lv3/"+a[2]},{allowFullScreen:"true",allowScriptAccess:"always"}]}):(a=c.match(/^([a-z]{1,3}\.)?gamespot\.com\/(videoembed\/|video\/\d+\/|[\w\/-]+\/video\/|[\w-]+\/videos\/[\w-]+-)(\d+)/))?g(b,{i:[{src:"http://"+(a[1]?a[1]:"www.")+"gamespot.com/videoembed/"+a[3]+"&mapp=false&ads=0&onsite=0",allowfullscreen:"true"}]}):A&&(a=c.match(A))?g(b,{a:[{controls:!0,preload:"metadata"},{src:f[1]+(f[2]?f[2]:"")+a[1]+a[2],type:r[a[2]]}]},{wt:300,ht:32,tp:2}):B&&(a=c.match(B))?g(b,{v:[{controls:!0,preload:"metadata"},{src:f[1]+(f[2]?f[2]:"")+a[1]+a[2],type:r[a[2]]}]}):c.match(/^([^\\\?\s<>"'&]+\.mp3)$/)?g(b,{o:[{data:y+"swf/mp3player.swf"},{FlashVars:"soundFile="+m,quality:"high",menu:"false"}]},{wt:"100%",ht:24,tp:1}):(a=c.match(/^hu(\.lk\/|lkshare\.com\/(.*fn=)?)([a-z\d]{12})($|[^a-z\d])/))?g(b,{i:[{src:"http://www.hulkshare.com/embed.php?fn="+a[3]}]},{wt:"100%",ht:160,tp:1}):(a=c.match(/^(mixcloud\.com\/(?!(categories|competitions|projects|developers|tag)\/)[\w-]+\/(?!(listens|favorites|activity|messages|following)\/)[\w-]+\/)$/))?g(b,{i:[{src:f[4]+"www.mixcloud.com/widget/iframe/?hide_artwork=1&embed_type=widget_standard&hide_tracklist=1&feed=http://www."+a[1]}]},{wt:"100%",ht:180,tp:1}):(a=c.match(/^(vk\.com\/video_ext\.php\?oid=[-\d]+&id=[-\d]+&hash=\w+(&sd|&hd=1|&hd=2)?)/))?g(b,{i:[{src:f[4]+a[1]}]}):(a=c.match(/^coub\.com\/view\/([a-zA-Z\d]+)/))?g(b,{i:[{src:"http://coub.com/embed/"+a[1]+"?muted=false"}]}):(a=c.match(/^vine\.co\/v\/([a-zA-Z\d]+)/))?g(b,{i:[{src:"https://vine.co/v/"+a[1]+"/embed/simple"}]},{wt:360,ht:360,tp:2}):(a=c.match(/^facebook\.com[\w\/]*\/(photo\.php\?(?:.+&)?v|video\.php\?(?:.+&)?v|embed\?(?:.+&)?video_id)=(\d+)/))&&g(b,{i:[{src:"https://www.facebook.com/video/embed?video_id="+a[2],allowfullscreen:"true"}]})}}},init:function(){l.addEventListener?l.addEventListener("DOMContentLoaded",FluxBB.media.run(),!1):/in/.test(l.readyState)?setTimeout(FluxBB.media.init,100):FluxBB.media.run()}}}(document,window,navigator);FluxBB.media.init();
