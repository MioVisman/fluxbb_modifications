// media.js v1.3.0 Copyright (C) 2013-2017 Visman (mio.visman@yandex.ru)
if("undefined"===typeof FluxBB||!FluxBB)var FluxBB={};FluxBB.media=function(n,z,p){function u(d,k,c){var g,a="",e=m(d);if(e.canPlayType){for(g=0;g<k.length;g++)""!==e.canPlayType(d+"/"+c[g])&&(r[k[g]]=d+"/"+c[g],a+=(a?"|":"")+k[g]);return a?new RegExp("^([^\\\\\\?\\s<>\"'&]+\\.)("+a+")$","i"):!1}return!1}function m(d){return n.createElementNS?n.createElementNS("http://www.w3.org/1999/xhtml",d):n.createElement(d)}function t(d,k,c,g,a){if("string"!==typeof k)return d.appendChild(k);var e,h="video"==k||"audio"==k;c=c||{};g=g||{};k=m(k);for(var b in c)c.hasOwnProperty(b)&&("style"==b?k.style.cssText=c[b]:k.setAttribute(b,c[b]));h&&(e=m("source"));for(b in g)g.hasOwnProperty(b)&&(h?e.setAttribute(b,g[b]):(e=m("param"),e.setAttribute("name",b),e.setAttribute("value",g[b]),k.appendChild(e)));h&&k.appendChild(e);if(!a)return d.appendChild(k);c=d.parentNode;return(d=d.nextSibling)?c.insertBefore(k,d):c.appendChild(k)}function h(h,k,c){var g,a,e;!g&&k.i&&(g="i");!g&&k.v&&(g="v");!g&&k.a&&(g="a");if(!g){if(!v)return!1;g="o"}c=c||{};c.wt=c.wt||640;c.ht=c.ht||360;var d=k[g][0],b=k[g][1]?k[g][1]:{};"i"==g?(e="iframe",d.frameborder="0",d.scrolling="no"):"v"==g?e="video":"a"==g?e="audio":(e="object",d.type="application/x-shockwave-flash",b.wmode="transparent");d.id="mediajs"+A++;if(2==c.tp){k=h;do a=k.parentNode.clientWidth||k.parentNode.offsetWidth,k=k.parentNode;while(k&&!a);50<a&&a<c.wt&&(a-=10,c.ht=parseInt(c.ht*a/c.wt),c.wt=a);d.width=c.wt;d.height=c.ht;k={style:"padding-top:5px;"};c={}}else 1==c.tp?(d.width="100%",d.height=c.ht,k={style:"padding-top:5px;overflow:hidden;position:relative;"+("string"==typeof c.wt?"width:"+c.wt+";":"max-width:"+c.wt+"px;")},c={style:"height:"+c.ht+";overflow:hidden;position:relative;"}):(d.style="position:absolute;left:0;top:0;width:100%;height:100%;",k={style:"padding-top:5px;overflow:hidden;position:relative;max-width:"+c.wt+"px;"},c={style:"overflow:hidden;position:relative;height:0;padding-bottom:"+100*c.ht/c.wt+"%;"});if(B&&"o"==g){e=g="";for(var f in d)d.hasOwnProperty(f)&&("data"==f?b.movie=d[f]:"type"!=f&&(g+=" "+f+'="'+d[f]+'"'));for(f in b)b.hasOwnProperty(f)&&(e+='<param name="'+f+'" value="'+b[f]+'" />');a=m("div");a.innerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+g+">"+e+"</object>";e=a.firstChild;a.removeChild(e)}t(t(t(h,"div",k,{},!0),"div",c),e,d,b);h.className+=(h.className?" ":"")+"mediajslink";return!0}function C(d){return/^\d+$/.test(d)?d:(d=d.match(/^((\d{1,2})h)?((\d{1,2})m)?((\d{1,2})s)?$/))?3600*(d[2]||0)+60*(d[4]||0)+1*(d[6]||0):""}var A=0,w="",r={},B=!!z.ActiveXObject,v=function(){if(p.plugins&&p.plugins.length&&p.mimeTypes&&p.mimeTypes["application/x-shockwave-flash"]&&p.mimeTypes["application/x-shockwave-flash"].enabledPlugin)return!0;try{return new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),!0}catch(d){}return!1}(),x=u("audio","mp3 m4a ogg oga webma wav".split(" "),"mpeg mp4 ogg ogg webm wav".split(" ")),y=u("video",["mp4","m4v","ogv","webm","webmv"],["mp4","mp4","ogg","webm","webm"]);return{run:function(){var d;if((d=n.querySelectorAll("#brd-main .entry-content"))&&d.length)w=PUNBB.env.sva_mediajs.url_swf+"/";else if(!(d=n.querySelectorAll(".postmsg"))||!d.length)return;for(var k in d)if(d[k].className&&!(-1<(" "+d[k].className+" ").indexOf(" postsignature "))){var c=d[k].getElementsByTagName("a"),g;for(g in c)if(c[g].href&&(!c[g].nextSibling||c[g].nextSibling.tagName&&"BR"==c[g].nextSibling.tagName.toUpperCase())&&(!c[g].previousSibling||c[g].previousSibling.tagName&&"BR"==c[g].previousSibling.tagName.toUpperCase())&&"P"==c[g].parentNode.tagName.toUpperCase()&&!/<(p|a|img|ul|ol)/i.test(c[g].innerHTML)){for(var a=c[g].parentNode;a!==d[k]&&"BLOCKQUOTE"!==a.tagName.toUpperCase();)a=a.parentNode;if(a===d[k]){var e,p,b,a=void 0,f=c[g],l=f.href;(a=l.split("re.php?u="))&&a[1]&&(l=decodeURIComponent(a[1]).replace(/(https?|ftp)___/g,"$1://"));l=l.replace(/&amp;/g,"&");if(e=l.match(/^(https?:\/\/)(www\.)?(.+)$/))if(b=e[3],e[4]="https:"==n.location.protocol?"https://":e[1],a=b.match(/^(?:[a-z\d-]+\.)?youtu(?:be(?:-nocookie)?\.com|\.be)\/(?:playlist|(?:(?:.*?[\?&]v=)?([\w-]{11})(?:\?|&|#|$)))/)){var m=["wmode=transparent","controls=2"],q=[],l="https://www.youtube.com/embed";a[1]?(l+="/"+a[1],e="start t end list rel loop".split(" ")):(m.push("listType=playlist"),e=["list","index","loop"],q=["list"]);for(p=b.split(/[\?&#]/);b=p.shift();)b=b.split("="),b[0]&&b[1]&&-1<e.indexOf(b[0])&&/^[\w-]+$/.test(b[1])&&("start"==b[0]||"t"==b[0]||"end"==b[0]?m.push(("end"==b[0]?"end":"start")+"="+C(b[1])):(m.push(b[0]+"="+b[1]),"loop"==b[0]&&"1"==b[1]&&a[1]&&m.push("playlist="+a[1])),b=q.indexOf(b[0]),-1<b&&q.splice(b,1));q.length||h(f,{i:[{src:l+"?"+m.join("&"),allowfullscreen:"true"}]})}else(a=b.match(/^(?:player\.)?vimeo\.com\/(?:video\/)?(\d+)/))?h(f,{i:[{src:e[4]+"player.vimeo.com/video/"+a[1],allowfullscreen:"true"}]}):(a=b.match(/^dai(?:lymotion\.com\/video|\.ly)\/([a-zA-Z\d]+)/))?h(f,{i:[{src:e[4]+"www.dailymotion.com/embed/video/"+a[1]+'?theme=none"',allowfullscreen:"true"}]}):(a=b.match(/^rutube\.ru\/tracks\/(?:\d+)\.html\?v=([a-zA-Z\d]+)/))?h(f,{o:[{data:e[4]+"video.rutube.ru/"+a[1]},{allowFullScreen:"true",allowScriptAccess:"always"}]}):(a=b.match(/^(?:rutube\.ru\/video\/embed|video\.rutube\.ru)\/(\d+)/))?h(f,{i:[{src:e[4]+"rutube.ru/video/embed/"+a[1],allowfullscreen:"true"}]}):(a=b.match(/^rutube\.ru\/video\/([a-zA-Z\d]+)/))?h(f,{i:[{src:e[4]+"rutube.ru/video/embed/"+a[1],allowfullscreen:"true"}]}):(a=b.match(/^(?:m\.)?my\.mail\.ru\/(?!video\/)([\w-]+\/[\w\.-]+\/)video\/([\w\.-]+\/[\w-]+)(?:\.html)?/))?h(f,{i:[{src:"https://videoapi.my.mail.ru/videos/embed/"+a[1]+a[2]+".html",allowfullscreen:"true"}]}):(a=b.match(/^(?:video\.mail\.ru|my\.mail\.ru\/video\/.+\#video\=|my\.mail\.ru\/video)\/([\w-]+\/[\w\.-]+\/[\w\.-]+\/[\w-]+)(?:\.html)?/))?h(f,{i:[{src:"https://videoapi.my.mail.ru/videos/embed/"+a[1]+".html",allowfullscreen:"true"}]}):(a=b.match(/^smotri\.com\/video\/view\/\?id=([a-zA-Z\d]+)/))?h(f,{o:[{data:"http://pics.smotri.com/player.swf?file="+a[1]+"&bufferTime=3&autoStart=false&str_lang=rus"},{allowFullScreen:"true",allowScriptAccess:"always"}]}):(a=b.match(/^(soundcloud\.com\/[\w-]+\/(sets\/)?[\w-]+|api\.soundcloud\.com\/(tracks|playlists)\/\d+)/))?h(f,{i:[{src:"https://w.soundcloud.com/player/?sharing=false&liking=false&show_playcount=false&show_comments=false&url="+l}]},{wt:"100%",ht:a[2]||"playlists"==a[3]?450:166,tp:1}):(a=b.match(/^www(\d+)\.zippyshare\.com\/v(?:\/|.*?key=)(\d+)/))?h(f,{o:[{data:"http://www"+a[1]+".zippyshare.com/swf/player_local.swf?file="+a[2]+"&server="+a[1]+"&baseurl=http://www.zippyshare.com/api/&flashid=null&autostart=false&availablequality=both"},{allowScriptAccess:"always",allowFullScreen:"false"}]},{wt:"100%",ht:80,tp:1}):(a=b.match(/^metacafe\.com\/(?:watch|embed)\/(\d+)/))?h(f,{i:[{src:"http://www.metacafe.com/embed/"+a[1]+"/",allowfullscreen:"true"}]}):v&&(a=b.match(/^video\.sibnet\.ru\/[^\?\&]*?video(\d+)/))?h(f,{i:[{src:e[4]+"video.sibnet.ru/shell.php?videoid="+a[1]+"/",allowfullscreen:"true"}]}):(a=b.match(/^promodj\.com\/(?:[^\/]+\/[^\/]+|download|embed)\/(\d+)/))?h(f,{i:[{src:e[4]+"promodj.com/embed/"+a[1]+"/big",allowfullscreen:"true"}]},{wt:"100%",ht:70,tp:1}):(a=b.match(/^(?:embed\.?)?pleer\.(?:com|net)\/track(?:s\/|\?id=)(\w+)/))?h(f,{o:[{data:"http://embedpleer.net/track?id="+a[1]}]},{wt:"100%",ht:42,tp:1}):(a=b.match(/^(?:embed\.?)?pleer\.(?:com|net)\/list(?:\?id=)?(\w+)/))?h(f,{o:[{data:"http://embedpleer.net/list?id="+a[1]}]},{wt:"100%",ht:300,tp:1}):(a=b.match(/^(?:[a-z]{1,3}\.)?(ign\.com\/videos\/\d{4}\/\d{1,2}\/\d{1,2}\/[\w-]+)/))?h(f,{i:[{src:"http://widgets.ign.com/video/embed/content.html?url=http://www."+a[1],allowfullscreen:"true"}]}):(a=b.match(/^(?:[a-z]{1,3}\.)?twitch\.tv\/\w+\/v\/(\d+)/))?h(f,{i:[{src:"https://player.twitch.tv/?autoplay=false&video=v"+a[1],allowfullscreen:"true"}]}):(a=b.match(/^(?:[a-z]{1,3}\.)?twitch\.tv\/(?!(?:directory|login|store|jobs)\b)(\w+)$/))?h(f,{i:[{src:"https://player.twitch.tv/?autoplay=false&channel="+a[1],allowfullscreen:"true"}]}):(a=b.match(/^g4tv\.com\/(?:videos|lv3)\/(\d+)/))?h(f,{o:[{data:"http://www.g4tv.com/lv3/"+a[1]},{allowFullScreen:"true",allowScriptAccess:"always"}]}):(a=b.match(/^([a-z]{1,3}\.)?gamespot\.com\/(?:videoembed\/|video\/\d+\/|[\w\/-]+\/video\/|[\w-]+\/videos\/[\w-]+-)(\d+)/))?h(f,{i:[{src:"http://"+(a[1]?a[1]:"www.")+"gamespot.com/videoembed/"+a[2]+"&mapp=false&ads=0&onsite=0",allowfullscreen:"true"}]}):x&&(a=b.match(x))?h(f,{a:[{controls:!0,preload:"metadata"},{src:e[1]+(e[2]?e[2]:"")+a[1]+a[2],type:r[a[2]]}]},{wt:300,ht:32,tp:2}):y&&(a=b.match(y))?h(f,{v:[{controls:!0,preload:"metadata"},{src:e[1]+(e[2]?e[2]:"")+a[1]+a[2],type:r[a[2]]}]}):b.match(/^([^\\\?\s<>"'&]+\.mp3)$/)?h(f,{o:[{data:w+"swf/mp3player.swf"},{FlashVars:"soundFile="+l,quality:"high",menu:"false"}]},{wt:"100%",ht:24,tp:1}):(a=b.match(/^hu(?:\.lk\/|lkshare\.com\/(?:.*?fn=)?)([a-z\d]{12})(?:$|[^a-z\d])/))?h(f,{i:[{src:"http://www.hulkshare.com/embed.php?fn="+a[1]}]},{wt:"100%",ht:160,tp:1}):(a=b.match(/^(mixcloud\.com\/(?!(categories|competitions|projects|developers|tag)\/)[\w-]+\/(?!(listens|favorites|activity|messages|following)\/)[\w-]+\/)$/))?h(f,{i:[{src:e[4]+"www.mixcloud.com/widget/iframe/?hide_artwork=1&embed_type=widget_standard&hide_tracklist=1&feed=http://www."+a[1]}]},{wt:"100%",ht:120,tp:1}):(a=b.match(/^(vk\.com\/video_ext\.php\?oid=[\d-]+&id=[\d-]+&hash=\w+(&sd|&hd=1|&hd=2)?)/))?h(f,{i:[{src:e[4]+a[1]}]}):(a=b.match(/^coub\.com\/view\/([a-zA-Z\d]+)/))?h(f,{i:[{src:"http://coub.com/embed/"+a[1]+"?muted=false"}]}):(a=b.match(/^vine\.co\/v\/([a-zA-Z\d]+)/))?h(f,{i:[{src:"https://vine.co/v/"+a[1]+"/embed/simple"}]},{wt:360,ht:360,tp:2}):(a=b.match(/^(?:[a-z\d-]+\.)?facebook\.com.*?\/(?:photo\.php|video\.php|embed|videos\/(?:vb\.\d+\/)?)(?:.*?[\?&]v(?:ideo_id)?=)?(\d+)(?=\/|&|$)/))?h(f,{i:[{src:"https://www.facebook.com/video/embed?video_id="+a[1],allowfullscreen:"true"}]}):(a=b.match(/^(?=[^\/]*\byandex\.(com|ru|ua)\/)(?=[^\?&]*\bmaps\b).+\/\-\/([\w\~\-]+)$/))?h(f,{i:[{src:"https://api-maps.yandex."+a[1]+"/frame/v1/-/"+a[2]}]},{wt:410,ht:350,tp:2}):(a=b.match(/^maps\.google\.((?:com?\.)?[a-z]{2,3})\/([a-z\d\?\.,\&\=]+)$/))?h(f,{i:[{src:("cn"==a[1]?"http://maps.google."+a[1]:"https://maps.google.com")+"/"+a[2]+"&ie=UTF8&output=embed"}]},{wt:410,ht:350,tp:2}):(a=b.match(/^google\.((?:com?\.)?[a-z]{2,3})\/maps\/embed\?pb=([^\s\?<>,&]+)$/))?h(f,{i:[{src:("cn"==a[1]?"http://www.google."+a[1]:"https://www.google.com")+"/maps/embed?pb="+a[2]}]},{wt:410,ht:350,tp:2}):(a=b.match(/^google\.((?:com?\.)?[a-z]{2,3})\/maps\/(?:place\/([^\/<>\[\]\?&]+))?[^\?&]*@(-?\d+\.\d+),(-?\d+\.\d+),(\d+(?:\.\d+)?)([zm])/))?(l=("cn"==a[1]?"http://maps.google."+a[1]:"https://maps.google.com")+"/?ll="+a[3]+","+a[4]+"&t="+("z"==a[6]?"m":"h")+"&z=",e=a[5],"z"!=a[6]&&(e=Math.log(704E5/e)/Math.log(2)),h(f,{i:[{src:l+Math.min(18,Math.max(Math.round(e),3))+(a[2]?"&q="+a[2]:"")+"&ie=UTF8&output=embed"}]},{wt:410,ht:350,tp:2})):(a=b.match(/^ok\.ru\/video(?:embed)?\/(\d+)/))?h(f,{i:[{src:"https://ok.ru/videoembed/"+a[1],allowfullscreen:"true"}]}):(a=b.match(/^liveleak\.com\/(?:view|ll_embed)\?i=(\w+)/))&&h(f,{i:[{src:"http://www.liveleak.com/ll_embed?i="+a[1],allowfullscreen:"true"}]})}}}},init:function(){n.addEventListener&&n.addEventListener("DOMContentLoaded",FluxBB.media.run(),!1)}}}(document,window,navigator);FluxBB.media.init();
