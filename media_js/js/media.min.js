// media.js v2.0.0 Copyright (C) 2013-2019 Visman (mio.visman@yandex.ru)
if("undefined"===typeof FluxBB||!FluxBB)var FluxBB={};FluxBB.media=function(l,v,m){function w(c,a,d){var f,e="",b=n(c);if(b.canPlayType){for(f=0;f<a.length;f++)""!==b.canPlayType(c+"/"+d[f])&&(r[a[f]]=c+"/"+d[f],e+=(e?"|":"")+a[f]);return e?new RegExp("^([^\\\\\\?\\s<>\"'&]+\\.)("+e+")$","i"):!1}return!1}function n(c){return l.createElementNS?l.createElementNS("http://www.w3.org/1999/xhtml",c):l.createElement(c)}function t(c,a,d,f,e){if("string"!==typeof a)return c.appendChild(a);var b,g="video"==a||"audio"==a;d=d||{};f=f||{};a=n(a);for(var h in d)d.hasOwnProperty(h)&&("style"==h?a.style.cssText=d[h]:a.setAttribute(h,d[h]));g&&(b=n("source"));for(h in f)f.hasOwnProperty(h)&&(g?b.setAttribute(h,f[h]):(b=n("param"),b.setAttribute("name",h),b.setAttribute("value",f[h]),a.appendChild(b)));g&&a.appendChild(b);if(!e)return c.appendChild(a);d=c.parentNode;return(c=c.nextSibling)?d.insertBefore(a,c):d.appendChild(a)}function q(c){return 0===c%1&&9<c?2:"string"===typeof c&&/^(?:100|[1-9]\d(?:\.\d{1,2})?)%$/.test(c)?1:0}function g(c,a,d){if(a.i)var f="i";else if(a.v)f="v";else if(a.a)f="a";else{if(!B)return!1;f="o"}var e=a[f][0];a=a[f][1]?a[f][1]:{};if("i"==f){var b="iframe";e.frameborder="0";e.scrolling="no";e.allowfullscreen||(e.allowfullscreen="allowfullscreen");u&&(e["data-src"]=e.src,delete e.src,"class"in e?e["class"]+=" mediajslazy":e["class"]="mediajslazy")}else"v"==f?b="video":"a"==f?b="audio":(b="object",e.type="application/x-shockwave-flash",a.wmode="transparent");e.id="mediajs"+x++;d=d||{};d.wt=d.wt||640;d.ht=d.ht||360;var g=q(d.wt);var h=q(d.ht);if(1===g&&2===h)e.style="width:100%;height:"+d.ht+"px;",g={style:"padding-top:5px;overflow:hidden;position:relative;width:"+d.wt+";"},d={style:"height:"+d.ht+"px;overflow:hidden;position:relative;"};else if(0<g&&0<h)e.style="position:absolute;left:0;top:0;width:100%;height:100%;",g={style:"padding-top:5px;overflow:hidden;position:relative;"+(1===g?"width:"+d.wt+";":"max-width:"+d.wt+"px;")},d={style:"overflow:hidden;position:relative;height:0;padding-bottom:"+(1===h?d.ht:100*d.ht/d.wt+"%;")};else return!1;if(C&&"o"==f){b=f="";for(k in e)e.hasOwnProperty(k)&&("data"==k?a.movie=e[k]:"type"!=k&&(f+=" "+k+'="'+e[k]+'"'));for(k in a)a.hasOwnProperty(k)&&(b+='<param name="'+k+'" value="'+a[k]+'" />');var k=n("div");k.innerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+f+">"+b+"</object>";b=k.firstChild;k.removeChild(b)}t(t(t(c,"div",g,{},!0),"div",d),b,e,a);c.classList.add("mediajslink");return!0}function D(c){return/^\d+$/.test(c)?c:(c=c.match(/^((\d{1,2})h)?((\d{1,2})m)?((\d{1,2})s)?$/))?3600*(c[2]||0)+60*(c[4]||0)+1*(c[6]||0):""}function E(c){var a,d,f=c.href;if(a=f.match(/^(.+)(?:#|%23)(\d+(?:\.\d{1,2})?)(%|%25)?(?::|%3A)(\d+(?:\.\d{1,2})?)(%|%25)?$/)){c.href=f=a[1];var e=a[2]+(a[3]?"%":"");var b=a[4]+(a[5]?"%":"");0<q(e)&&0<q(b)&&(d={wt:e,ht:b})}(a=f.split("re.php?u="))&&a[1]&&(f=decodeURIComponent(a[1]).replace(/(https?|ftp)___/g,"$1://"));f=f.replace(/&amp;/g,"&");if(e=f.match(/^(https?:\/\/)(www\.)?(.+)$/))if(b=e[3],e[4]="https:"==l.location.protocol?"https://":e[1],a=b.match(/^(?:[a-z\d-]+\.)?youtu(?:be(?:-nocookie)?\.com|\.be)\/(?:playlist|(?:(?:.*?[\?&]v=)?([\w-]{11})(?:\?|&|#|$)))/)){var p=["wmode=transparent","controls=2"],h=[];f="https://www.youtube.com/embed";if(a[1]){f+="/"+a[1];var k="start t end list rel loop".split(" ")}else p.push("listType=playlist"),k=["list","index","loop"],h=["list"];for(e=b.split(/[\?&#]/);b=e.shift();)b=b.split("="),b[0]&&b[1]&&-1<k.indexOf(b[0])&&/^[\w-]+$/.test(b[1])&&("start"==b[0]||"t"==b[0]||"end"==b[0]?p.push(("end"==b[0]?"end":"start")+"="+D(b[1])):(p.push(b[0]+"="+b[1]),"loop"==b[0]&&"1"==b[1]&&a[1]&&p.push("playlist="+a[1])),b=h.indexOf(b[0]),-1<b&&h.splice(b,1));h.length||g(c,{i:[{src:f+"?"+p.join("&")}]},d)}else(a=b.match(/^(?:player\.)?vimeo\.com\/(?:video\/)?(\d+)/))?g(c,{i:[{src:e[4]+"player.vimeo.com/video/"+a[1]}]},d):(a=b.match(/^dai(?:lymotion\.com\/video|\.ly)\/([a-zA-Z\d]+)/))?g(c,{i:[{src:e[4]+"www.dailymotion.com/embed/video/"+a[1]+'?theme=none"'}]},d):(a=b.match(/^rutube\.ru\/tracks\/(?:\d+)\.html\?v=([a-zA-Z\d]+)/))?g(c,{o:[{data:e[4]+"video.rutube.ru/"+a[1]},{allowFullScreen:"true",allowScriptAccess:"always"}]},d):(a=b.match(/^(?:rutube\.ru\/video\/embed|video\.rutube\.ru)\/(\d+)/))?g(c,{i:[{src:e[4]+"rutube.ru/video/embed/"+a[1]}]},d):(a=b.match(/^rutube\.ru\/video\/([a-zA-Z\d]+)/))?g(c,{i:[{src:e[4]+"rutube.ru/video/embed/"+a[1]}]},d):(a=b.match(/^(soundcloud\.com\/[\w-]+\/(sets\/)?[\w-]+|api\.soundcloud\.com\/(tracks|playlists)\/\d+)/))?g(c,{i:[{src:"https://w.soundcloud.com/player/?sharing=false&liking=false&show_playcount=false&show_comments=false&url="+f}]},d||{wt:"100%",ht:a[2]||"playlists"==a[3]?450:166}):(a=b.match(/^www(\d+)\.zippyshare\.com\/v(?:\/|.*?key=)(\d+)/))?g(c,{o:[{data:"http://www"+a[1]+".zippyshare.com/swf/player_local.swf?file="+a[2]+"&server="+a[1]+"&baseurl=http://www.zippyshare.com/api/&flashid=null&autostart=false&availablequality=both"},{allowScriptAccess:"always",allowFullScreen:"false"}]},d||{wt:"100%",ht:80}):(a=b.match(/^metacafe\.com\/(?:watch|embed)\/(\d+)/))?g(c,{i:[{src:"http://www.metacafe.com/embed/"+a[1]+"/"}]},d):(a=b.match(/^video\.sibnet\.ru\/[^\?&]*?video(\d+)/))?g(c,{i:[{src:e[4]+"video.sibnet.ru/shell.php?videoid="+a[1]+"/"}]},d):(a=b.match(/^promodj\.com\/(?:[^\/]+\/[^\/]+|download|embed)\/(\d+)/))?g(c,{i:[{src:e[4]+"promodj.com/embed/"+a[1]+"/big"}]},d||{wt:"100%",ht:70}):(a=b.match(/^(?:[a-z]{1,3}\.)?(ign\.com\/videos\/\d{4}\/\d{1,2}\/\d{1,2}\/[\w-]+)/))?g(c,{i:[{src:e[4]+"widgets.ign.com/video/embed/content.html?url=https://www."+a[1]}]},d):(a=b.match(/^(?:[a-z]{1,3}\.)?twitch\.tv\/\w+\/v\/(\d+)/))?g(c,{i:[{src:"https://player.twitch.tv/?autoplay=false&video=v"+a[1]}]},d):(a=b.match(/^(?:[a-z]{1,3}\.)?twitch\.tv\/(?!(?:directory|login|store|jobs)\b)(\w+)$/))?g(c,{i:[{src:"https://player.twitch.tv/?autoplay=false&channel="+a[1]}]},d):(a=b.match(/^([a-z]{1,}\.)?gamespot\.com\/(?:video(?:s|embed)?|[\w\/-]+\/videos?)(?=\/)[^\?&#]*[\/-](\d{7,})\//))?(b=b.split("?"),b=b[1]?b[1].replace(/&?autoplay=[^&]*/g,"").replace(/^&/,""):!1,g(c,{i:[{src:"https://www.gamespot.com/videos/embed/"+a[2]+"/"+(b?"?"+b:"")}]},d)):y&&(a=b.match(y))?g(c,{a:[{controls:!0,preload:"metadata",controlsList:"nodownload"},{src:e[1]+(e[2]?e[2]:"")+a[1]+a[2],type:r[a[2]]}]},d||{wt:"100%",ht:50}):z&&(a=b.match(z))?g(c,{v:[{controls:!0,preload:"metadata",controlsList:"nodownload"},{src:e[1]+(e[2]?e[2]:"")+a[1]+a[2],type:r[a[2]]}]},d):b.match(/^([^\\\?\s<>"'&]+\.mp3)$/)?g(c,{o:[{data:A+"swf/mp3player.swf"},{FlashVars:"soundFile="+f,quality:"high",menu:"false"}]},{wt:"100%",ht:24}):(a=b.match(/^hu(?:\.lk\/|lkshare\.com\/(?:.*?fn=)?)([a-z\d]{12})(?:$|[^a-z\d])/))?g(c,{i:[{src:e[4]+"www.hulkshare.com/embed.php?fn="+a[1]}]},d||{wt:"100%",ht:160}):(a=b.match(/^(mixcloud\.com\/(?!(categories|competitions|projects|developers|tag)\/)[\w-]+\/(?!(listens|favorites|activity|messages|following)\/)[\w-]+\/)$/))?g(c,{i:[{src:e[4]+"www.mixcloud.com/widget/iframe/?hide_artwork=1&embed_type=widget_standard&hide_tracklist=1&feed=http://www."+a[1]}]},d||{wt:"100%",ht:120}):(a=b.match(/^(vk\.com\/video_ext\.php\?oid=[\d-]+&id=[\d-]+&hash=\w+(&sd|&hd=1|&hd=2)?)/))?g(c,{i:[{src:e[4]+a[1]}]},d):(a=b.match(/^coub\.com\/view\/([a-zA-Z\d]+)/))?g(c,{i:[{src:e[4]+"coub.com/embed/"+a[1]+"?muted=false&autostart=false&originalSize=false"}]},d):(a=b.match(/^vine\.co\/v\/([a-zA-Z\d]+)/))?g(c,{i:[{src:"https://vine.co/v/"+a[1]+"/embed/simple"}]},d||{wt:360,ht:360}):(a=b.match(/^(?:[a-z\d-]+\.)?facebook\.com.*?\/(?:photo\.php|video\.php|embed|videos\/(?:vb\.\d+\/)?)(?:.*?[\?&]v(?:ideo_id)?=)?(\d+)(?=\/|&|$)/))?g(c,{i:[{src:"https://www.facebook.com/video/embed?video_id="+a[1]}]},d):(a=b.match(/^(?=[^\/]*\byandex\.(com|ru|ua)\/)(?=[^\?&]*\bmaps\b).+\/\-\/([\w~\-]+)$/))?g(c,{i:[{src:"https://api-maps.yandex."+a[1]+"/frame/v1/-/"+a[2]}]},d||{wt:410,ht:350}):(a=b.match(/^maps\.google\.((?:com?\.)?[a-z]{2,3})\/([a-z\d\?\.,&=]+)$/))?g(c,{i:[{src:("cn"==a[1]?"http://maps.google."+a[1]:"https://maps.google.com")+"/"+a[2]+"&ie=UTF8&output=embed"}]},d||{wt:410,ht:350}):(a=b.match(/^google\.((?:com?\.)?[a-z]{2,3})\/maps\/embed\?pb=([^\s\?<>,&]+)$/))?g(c,{i:[{src:("cn"==a[1]?"http://www.google."+a[1]:"https://www.google.com")+"/maps/embed?pb="+a[2]}]},d||{wt:410,ht:350}):(a=b.match(/^google\.((?:com?\.)?[a-z]{2,3})\/maps\/(?:place\/([^\/<>\[\]\?&]+))?[^\?&]*@(-?\d+\.\d+),(-?\d+\.\d+),(\d+(?:\.\d+)?)([zm])/))?(f=("cn"==a[1]?"http://maps.google."+a[1]:"https://maps.google.com")+"/?ll="+a[3]+","+a[4]+"&t="+("z"==a[6]?"m":"h")+"&z=",b=a[5],"z"!=a[6]&&(b=Math.log(704E5/b)/Math.log(2)),g(c,{i:[{src:f+Math.min(18,Math.max(Math.round(b),3))+(a[2]?"&q="+a[2]:"")+"&ie=UTF8&output=embed"}]},d||{wt:410,ht:350})):(a=b.match(/^ok\.ru\/video(?:embed)?\/(\d+)/))?g(c,{i:[{src:"https://ok.ru/videoembed/"+a[1]}]},d):(a=b.match(/^liveleak\.com\/(?:view|ll_embed)\?([a-z])=(\w+)/))?g(c,{i:[{src:e[4]+"www.liveleak.com/ll_embed?"+a[1]+"="+a[2]}]},d):(a=b.match(/^video\.online\.ua\/(?:embed\/)?(\d+)\//))?g(c,{i:[{src:e[4]+"video.online.ua/embed/"+a[1]+"/"}]},d):(a=b.match(/^aparat\.com\/(?:v|embed)\/(\w+)/))?g(c,{i:[{src:"https://www.aparat.com/video/video/embed/videohash/"+a[1]+"/vt/frame"}]},d):(a=b.match(/^audiomack\.com\/(?:embed\/)?song\/([\w-]+\/[\w-]+)/))?g(c,{i:[{src:"https://audiomack.com/embed/song/"+a[1]+"?background=1"}]},d||{wt:"100%",ht:252}):(a=b.match(/^audiomack\.com\/(?:embed\/)?playlist\/([\w-]+\/[\w-]+)/))?g(c,{i:[{src:"https://audiomack.com/embed/playlist/"+a[1]+"?background=1"}]},d||{wt:"100%",ht:400}):(a=b.match(/^dumpert\.nl\/(?:mediabase|embed)(\/\d+\/[\dabcdef]+\/)/))?g(c,{i:[{src:"https://www.dumpert.nl/embed"+a[1]}]},d):(a=b.match(/^izlesene\.com\/(?:embedplayer|video\/[^\/]+)\/(\d+)/))&&g(c,{i:[{src:"https://www.izlesene.com/embedplayer/"+a[1]+"/?showrel=0&loop=0&autoplay=0&autohide=1&showinfo=1&socialbuttons=1&annotation=&volume=0.5"}]},d)}var x=0,A="",r={},C=!!v.ActiveXObject,B=function(){if(m.plugins&&m.plugins.length&&m.mimeTypes&&m.mimeTypes["application/x-shockwave-flash"]&&m.mimeTypes["application/x-shockwave-flash"].enabledPlugin)return!0;try{return new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),!0}catch(c){}return!1}(),y=w("audio","mp3 m4a ogg oga webma wav".split(" "),"mpeg mp4 ogg ogg webm wav".split(" ")),z=w("video",["mp4","m4v","ogv","webm","webmv"],["mp4","mp4","ogg","webm","webm"]),u=!1;return{run:function(){var c;if((c=l.querySelectorAll("#brd-main .entry-content"))&&c.length)A=PUNBB.env.sva_mediajs.url_swf+"/";else if(!(c=l.querySelectorAll(".postmsg"))||!c.length)return;"IntersectionObserver"in v&&!/Googlebot|YandexBot/.test(m.userAgent)&&(u=!0);for(var a in c)if(c[a].className&&!c[a].classList.contains("postsignature")){var d=c[a].getElementsByTagName("a"),f;for(f in d)if(d[f].href&&(!d[f].nextSibling||d[f].nextSibling.tagName&&"BR"==d[f].nextSibling.tagName.toUpperCase())&&(!d[f].previousSibling||d[f].previousSibling.tagName&&"BR"==d[f].previousSibling.tagName.toUpperCase())&&"P"==d[f].parentNode.tagName.toUpperCase()&&!/<(p|a|img|ul|ol)/i.test(d[f].innerHTML)){for(var e=d[f].parentNode;e!==c[a]&&"BLOCKQUOTE"!==e.tagName.toUpperCase();)e=e.parentNode;e===c[a]&&E(d[f])}}if(u&&x){c=[].slice.call(l.querySelectorAll(".mediajslazy"));var b=new IntersectionObserver(function(a,b){a.forEach(function(a){if(a.isIntersecting){a=a.target;try{a.contentWindow.location.replace(a.dataset.src)}catch(F){a.src=a.dataset.src}a.classList.remove("mediajslazy");b.unobserve(a)}})});c.forEach(function(a){b.observe(a)})}},init:function(){l.addEventListener&&l.addEventListener("DOMContentLoaded",FluxBB.media.run(),!1)}}}(document,window,navigator);FluxBB.media.init();
